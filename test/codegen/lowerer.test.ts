import { get_index, IndexContext, lower_load_store, lower_reduce_axis, rewrite_shapetracker_with_index } from '../../src/codegen/lowerer.ts'
import { DType, PtrDType } from '../../src/dtype.ts'
import { KernelInfo, Ops, UOp } from '../../src/ops.ts'
import { ClangRenderer } from '../../src/renderer/cstyle.ts'
import { ShapeTracker } from '../../src/shape/shapetracker.ts'
import { View } from '../../src/shape/view.ts'
import { compare } from '../helpers.ts'

Deno.test(
  'get_index',
  compare(
    [
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([16, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([16, 4], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([200, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([200, 4], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([20000, 1, 3, 1], [3, 0, 1, 0], 0, undefined, true)])), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.REDUCE_AXIS, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([60001, 119999], [0, 0], 0, [[0, 60001], [59999, 119999]], false), new View([20000, 15000, 3, 4], [3, 480000, 1, 120000], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1, 3]]), new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([20000, 1, 3, 1], [0, 0, 0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], -1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], undefined)], undefined)], new KernelInfo(0, 2, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.ADD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.LOAD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 32), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.ADD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 1.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined), new UOp(Ops.MUL, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.LOAD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], -1.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10, 1], [1, 0], 0, undefined, true)])), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.REDUCE_AXIS, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([11, 19], [0, 0], 0, [[0, 11], [9, 19]], false), new View([10, 10], [1, 20], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1]]), new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10, 1], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], -1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10], [1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10], [0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 1.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
    ],
    get_index,
    'out(tiny.codegen.lowerer.get_index(*data))',
  ),
)

Deno.test(
  'lower_reduce_axis',
  compare(
    [
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 128, `int32`, undefined, 32, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31])], [[1, 32]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 128, `int32`, undefined, 32, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31])], [[1, 32]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 128, `int32`, undefined, 32, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31])], [[1, 32]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 63)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 31)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 400)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 400)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 400)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 3200)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 800)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 799)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 399)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1, 2]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.LOAD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 1), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 32)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 256)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined)], [Ops.ADD, [1, 2]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 960)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 720)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[2, 3]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 960)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 720)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[2, 3]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 960)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 3)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 720)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 23040)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[2, 3]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5760)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5759)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 2879)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1, 3]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 196)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 2), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1500)], 3), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[5, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 196)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 2), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1500)], 3), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[5, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.MUL, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.LOAD, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [], 1), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 196)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 2), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4704000)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1500)], 3), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 3136)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[5, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 784)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.CAST, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.LOAD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 2), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.LOAD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 3), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 2), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 6000)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1500)], 3), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.WHERE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], false)], undefined)], undefined)], undefined)], undefined)], [Ops.ADD, [3, 6]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 256)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 256)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 256)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 64)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 2048)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 512)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 511)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 255)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1, 2]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 250)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 60)], 2), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 250)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 60)], 2), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.MUL, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.LOAD, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [], 1), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 250)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 240)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 60)], 2), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.CAST, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.LOAD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 2), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 128)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[3, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.LOAD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 3), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 250)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 240)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 60)], 2), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[4, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.WHERE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], false)], undefined)], undefined)], undefined)], undefined)], [Ops.ADD, [2, 4]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 512)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 24)], 2), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 3), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5)], 4), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[5, 3]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[7, 5]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 512)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 1), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 24)], 2), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 3), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5)], 4), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[5, 3]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[7, 5]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.MUL, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CAST, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.LOAD, new DType(2, 1, `unsigned char`, `B`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(2, 1, `unsigned char`, `B`, 1, undefined, new DType(2, 1, `unsigned char`, `B`, 1, undefined), false, 1), [], 1), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 512)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 784)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 24)], 2), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 28)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 3), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 3)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5)], 4), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 28)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[5, 3]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[7, 5]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined)], undefined), new UOp(Ops.LOAD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 2), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 8)], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5)], 4), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 5)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[6, 4]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 25)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[7, 5]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined)], undefined)], undefined)], undefined)], [Ops.ADD, [4, 7]])],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 40, `int10`, undefined, 10, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])], [[1, 10]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 40, `int10`, undefined, 10, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])], [[1, 10]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 40, `int10`, undefined, 10, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])], [[1, 10]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 20)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 19)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 9)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1]])],
      [new IndexContext([new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[0, 5]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[1, 5]])], [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[0, 5]]), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[1, 5]])], 0), new UOp(Ops.REDUCE_AXIS, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.MUL, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CMPNE, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.CMPLT, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.MOD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.IDIV, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[0, 5]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined)], undefined), new UOp(Ops.MUL, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 20, `int5`, undefined, 5, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3, 4])], [[1, 5]]), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], undefined)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 9)], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 4)], undefined), new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true)], undefined)], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1]])],
    ],
    lower_reduce_axis,
    'out(tiny.codegen.lowerer.lower_reduce_axis(*data))',
  ),
)

Deno.test(
  'lower_load_store',
  compare(
    [
      [new IndexContext([], [], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.BITCAST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 1.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], undefined)],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1920)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[1, 3]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1920)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[1, 3]])], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([1920, 3], [3, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)],
      [new IndexContext([], [], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.ADD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.LOAD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], undefined), new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 32), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], undefined)], undefined)],
      [new IndexContext([], [], 0), new UOp(Ops.LOAD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined)],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 6144)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[1, 3]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 6144)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 12, `int3`, undefined, 3, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2])], [[1, 3]])], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([6144, 3], [3, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 16)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[1, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 16)], 0), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[1, 4]])], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([16, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)],
      [new IndexContext([], [], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.MUL, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.LOAD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.INDEX, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], undefined), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.9), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], undefined)],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 400)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 400)], 0), new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 100)], 1), new UOp(Ops.EXPAND, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VCONST, new DType(5, 16, `int4`, undefined, 4, new DType(5, 4, `int`, `i`, 1, undefined)), [], [0, 1, 2, 3])], [[2, 4]])], 1), new UOp(Ops.LOAD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([400, 1, 1], [0, 0, 0], 0, undefined, false)]))], undefined)],
      [new IndexContext([new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 0)], [new UOp(Ops.RANGE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 10)], 0)], 0), new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10], [1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.CONST, new DType(0, 1, `bool`, `?`, 1, undefined), [], true), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)],
    ],
    lower_load_store,
    'out(tiny.codegen.lowerer.lower_load_store(*data))',
  ),
)

Deno.test(
  'rewrite_shapetracker_with_index',
  compare(
    [
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([8, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([8, 4], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([12288, 3], [3, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([12288, 3], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.MUL, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.LOAD, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.999), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.ADD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.LOAD, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(6, 4, `unsigned int`, `I`, 1, undefined, new DType(6, 4, `unsigned int`, `I`, 1, undefined), false, 1), [], 1), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.WHERE, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 25600), new UOp(Ops.CONST, new DType(6, 4, `unsigned int`, `I`, 1, undefined), [], 0)], undefined)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([6400, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([6400, 4], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([16, 4], [4, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([16, 4], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([1920, 3], [3, 1], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([1920, 3], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(5, 4, `int`, `i`, 1, undefined, new DType(5, 4, `int`, `i`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10, 1], [1, 0], 0, undefined, true)])), new UOp(Ops.ADD, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.REDUCE_AXIS, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([11, 19], [0, 0], 0, [[0, 11], [9, 19]], false), new View([10, 10], [1, 20], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], [Ops.ADD, [1]]), new UOp(Ops.WHERE, new DType(5, 4, `int`, `i`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([10, 1], [0, 0], 0, undefined, false)]))], undefined), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], -1), new UOp(Ops.CONST, new DType(5, 4, `int`, `i`, 1, undefined), [], 0)], undefined)], undefined)], undefined)], new KernelInfo(0, 1, false)), new ClangRenderer()],
      [new UOp(Ops.SINK, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.STORE, new DType(-1, 0, `void`, undefined, 1, undefined), [new UOp(Ops.DEFINE_GLOBAL, new PtrDType(11, 4, `float`, `f`, 1, undefined, new DType(11, 4, `float`, `f`, 1, undefined), false, 1), [], 0), new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)])), new UOp(Ops.WHERE, new DType(11, 4, `float`, `f`, 1, undefined), [new UOp(Ops.VALID, new DType(0, 1, `bool`, `?`, 1, undefined), [new UOp(Ops.VIEW, new DType(-1, 0, `void`, undefined, 1, undefined), [], new ShapeTracker([new View([], [], 0, undefined, true)]))], undefined), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 1.0), new UOp(Ops.CONST, new DType(11, 4, `float`, `f`, 1, undefined), [], 0.0)], undefined)], undefined)], new KernelInfo(0, 0, false)), new ClangRenderer()],
    ],
    rewrite_shapetracker_with_index,
    'out(tiny.codegen.lowerer.rewrite_shapetracker_with_index(*data))',
  ),
)
